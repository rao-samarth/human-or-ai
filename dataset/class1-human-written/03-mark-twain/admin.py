# This is generated by Claude Sonnet 4.5
# This file is for administrative tasks related to the Mark Twain dataset.
# It has nothing to do with the task at hand itself.

#!/usr/bin/env python3
"""
Script to analyze books in the Mark Twain directory.
Creates a CSV file with book statistics.
"""

import os
import csv
from pathlib import Path


def count_words_in_paragraph(paragraph):
    """Count the number of words in a paragraph."""
    return len(paragraph.split())


def analyze_book(filepath):
    """
    Analyze a book file and return statistics.
    
    Returns:
        tuple: (filename, total_paragraphs, paragraphs_100_250_words)
    """
    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # Split by double newlines to get paragraphs
    # A paragraph is separated by a blank line (which creates \n\n)
    paragraphs = content.split('\n\n')
    
    # Filter out empty paragraphs and count
    paragraphs = [p.strip() for p in paragraphs if p.strip()]
    total_paragraphs = len(paragraphs)
    
    # Count paragraphs with 100-250 words
    paragraphs_100_250 = 0
    for paragraph in paragraphs:
        word_count = count_words_in_paragraph(paragraph)
        if 100 <= word_count <= 250:
            paragraphs_100_250 += 1
    
    return (filepath.name, total_paragraphs, paragraphs_100_250)


def main():
    """Main function to process all books and create CSV."""
    # Get the directory where this script is located
    script_dir = Path(__file__).parent
    
    # Get all .txt files (excluding README files)
    book_files = sorted([f for f in script_dir.glob('*.txt') if f.is_file()])
    
    results = []
    
    print(f"Found {len(book_files)} book files. Analyzing...")
    
    for book_file in book_files:
        print(f"Processing: {book_file.name}")
        stats = analyze_book(book_file)
        results.append(stats)
    
    # Write results to CSV
    output_file = script_dir / 'admin.csv'
    with open(output_file, 'w', newline='', encoding='utf-8') as csvfile:
        writer = csv.writer(csvfile)
        writer.writerow(['Book', 'Total Paragraphs', 'Paragraphs (100-250 words)'])
        writer.writerows(results)
    
    print(f"\nAnalysis complete! Results saved to: {output_file}")
    print(f"Total books analyzed: {len(results)}")


if __name__ == '__main__':
    main()
